# STEP Task 模板 — 在 Phase 3 中为每个任务生成
# 文件名: .step/changes/{change}/tasks/{slug}.yaml
id: task-slug       # 语义化 slug，与文件名一致（不含 .yaml）
title: "任务标题"
mode: full          # full | lite
status: planned     # planned | ready | in_progress | blocked | done
depends_on: []
goal: "一句话描述任务目标"
non_goal:
  - "不做什么"

# 完成条件（命令级）
done_when:
  - "pnpm lint"
  - "pnpm tsc --noEmit"
  - "pnpm vitest run test/xxx/xxx.test.ts"

# BDD 场景矩阵（4 类必须覆盖）
scenarios:
  happy_path:
    - id: S-task-slug-01
      given: "正常输入"
      when: "执行操作"
      then: "预期输出"
      test_file: "test/xxx/xxx.test.ts"
      test_name: "[S-task-slug-01] 描述"
      test_type: unit  # unit | integration | e2e
      status: not_run  # not_run | fail | pass

  edge_cases:
    - id: S-task-slug-02
      given: "边界输入"
      when: "执行操作"
      then: "预期输出"
      test_file: "test/xxx/xxx.test.ts"
      test_name: "[S-task-slug-02] 描述"
      test_type: unit
      status: not_run

  error_handling:
    - id: S-task-slug-03
      given: "异常输入或环境"
      when: "执行操作"
      then: "预期错误处理"
      test_file: "test/xxx/xxx.test.ts"
      test_name: "[S-task-slug-03] 描述"
      test_type: integration
      status: not_run

# 场景覆盖要求
coverage_requirements:
  happy_path: 1+
  edge_cases: 2+
  error_handling: 1+
  security: "按需"

rollback: "git revert --no-commit HEAD~N"
