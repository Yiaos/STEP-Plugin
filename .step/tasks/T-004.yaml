# T-004: SKILL.md 文字增强（F-6 + F-7）
id: T-004
title: "SKILL.md 执行规则增强 — 2-Action Rule + Pre-decision Read"
status: planned
depends_on: [T-001]
goal: "Phase 4 段落增加进度更新频率要求，Execution 硬规则增加修改前 Read 约束"
non_goal:
  - "不修改 hook frontmatter"
  - "不修改 Phase 0-3 规则"

done_when:
  - "bash tests/test-t004.sh"

scenarios:
  happy_path:
    - id: S-004-01
      given: "SKILL.md 已更新"
      when: "检查 Phase 4 段落"
      then: "包含 '2 次工具调用' 或类似进度更新频率要求"
      test_file: "tests/test-t004.sh"
      test_name: "[S-004-01] Phase 4 包含进度更新频率"
      test_type: unit
      status: not_run
    - id: S-004-02
      given: "SKILL.md 已更新"
      when: "检查 Execution 硬规则段落"
      then: "包含 '修改文件前必须先 Read' 或等效规则"
      test_file: "tests/test-t004.sh"
      test_name: "[S-004-02] 硬规则包含 Pre-decision Read"
      test_type: unit
      status: not_run

  edge_cases:
    - id: S-004-03
      given: "SKILL.md frontmatter YAML 部分"
      when: "解析 frontmatter"
      then: "YAML 语法仍然合法（新增正文不影响 frontmatter）"
      test_file: "tests/test-t004.sh"
      test_name: "[S-004-03] frontmatter YAML 语法合法"
      test_type: unit
      status: not_run
    - id: S-004-04
      given: "SKILL.md 硬规则编号"
      when: "检查编号连续性"
      then: "规则编号连续（1-6），无跳号"
      test_file: "tests/test-t004.sh"
      test_name: "[S-004-04] 硬规则编号连续"
      test_type: unit
      status: not_run

  error_handling:
    - id: S-004-05
      given: "SKILL.md 整体文件"
      when: "检查 --- 分隔符数量"
      then: "恰好 2 个 --- 行（frontmatter 开始和结束）"
      test_file: "tests/test-t004.sh"
      test_name: "[S-004-05] frontmatter 分隔符完整"
      test_type: integration
      status: not_run

  e2e:
    - id: S-004-06
      given: "install.sh 已将 SKILL.md 安装到 ~/.config/opencode/skills/step/"
      when: "对比源文件和安装文件"
      then: "内容一致"
      test_file: "tests/test-t004.sh"
      test_name: "[S-004-06] 安装后 SKILL.md 内容一致"
      test_type: e2e
      status: not_run

coverage_requirements:
  happy_path: 2
  edge_cases: 2
  error_handling: 1
  e2e: 1

rollback: "git checkout -- skills/step/SKILL.md"
